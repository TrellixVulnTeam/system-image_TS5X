system-image (2.1-0ubuntu4) trusty; urgency=medium

  [ St√©phane Graber ]
  * New upstream release.
  * Set X-Auto-Uploader to no-rewrite-version
  * Set Vcs-Bzr to the new target branch

  [ Barry Warsaw ]
  * New upstream release.
    - LP: #1279056 - Internal improvements to SignatureError for
      better debugging.
    - LP: #1277589 - Better protection against race conditions.
    - LP: #1260768 - Return empty string from ApplyUpdate D-Bus method.
    - LP: #1284217 - Send UpdateAvailableStatus during auto-downloading
      from a previous CheckForUpdate, if cached status is available.
    - Request ubuntu-download-manager to download to a temporary location,
      with atomic rename.
    - More detailed logging.
    - Fixed D-Bus error logging.
    - Added -L flag to nose2 tests for explicitly setting log file path.
    - Added SYSTEMIMAGE_DBUS_DAEMON_HUP_SLEEP_SECONDS environment variable
      which can be used to give virtualized buildds a fighting chance.
  * d/patches/01_send_ack_on_applyupdate.diff: Removed; applied upstream.
  * d/patches/lp1284217.patch: Added (see above).
  * d/control:
    - Bump Standards-Version to 3.9.5 with no other changes necessary.
    - Add python3-psutil as Depends to system-image-dev.
  * d/rules: Set SYSTEMIMAGE_DBUS_DAEMON_HUP_SLEEP_SECONDS to 1 to deal with
    buildd dbus-daemon SIGHUP timing issues.

 -- Ubuntu daily release <ps-jenkins@lists.canonical.com>  Tue, 25 Feb 2014 17:48:27 +0000

system-image (2.0.3-0ubuntu2) trusty; urgency=low

  * Fix ApplyUpdate() to return an empty string as per spec if the update
    is successfull (LP: #1260712)

 -- Didier Roche <didrocks@ubuntu.com>  Fri, 13 Dec 2013 13:55:51 +0100

system-image (2.0.3-0ubuntu1) trusty; urgency=low

  * New upstream release.
  * d/control: Re-enable DEP-8 tests.
  * d/tests/smoketest: A simpler test that shouldn't be susceptible to D-Bus
    flakiness in the autopkgtest VMs, but which does require network
    access to system-image.ubuntu.com (deemed okay as per pitti).

 -- Barry Warsaw <barry@ubuntu.com>  Mon, 09 Dec 2013 10:01:34 -0500

system-image (2.0.2-0ubuntu4) trusty; urgency=low

  * d/control: Commenting out XS-Testsuite to disable autopkgtests.  The
    DEP-8 tests are identical to the tox driven in-tree test suite, which
    is also run at build time.  In both of the latter two environments,
    the tests pass just fine, but something about the autopkgtests Jenkins
    environment causes flakiness in sockets and D-Bus which are
    unreproducible locally.

 -- Barry Warsaw <barry@ubuntu.com>  Sat, 07 Dec 2013 14:07:15 -0500

system-image (2.0.2-0ubuntu3) trusty; urgency=low

  * No change rebuild to see if we get lucky with -proposed migration.

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 06 Dec 2013 16:34:08 -0500

system-image (2.0.2-0ubuntu2) trusty; urgency=low

  * d/tests/control: Update autopkgtest dependency for nose2.

 -- Barry Warsaw <barry@ubuntu.com>  Thu, 05 Dec 2013 11:24:44 -0500

system-image (2.0.2-0ubuntu1) trusty; urgency=low

  * New upstream release.
    - LP: #1256947 - Fix FTBFS on buildds.
  * d/rules: Add fake https_proxy too, now that PyPI runs on https.

 -- Barry Warsaw <barry@ubuntu.com>  Tue, 03 Dec 2013 10:57:39 -0500

system-image (2.0.1-0ubuntu1) trusty; urgency=low

  * New upstream release.
    - Fix some build environment test failures.

 -- Barry Warsaw <barry@ubuntu.com>  Wed, 27 Nov 2013 10:57:39 -0500

system-image (2.0-0ubuntu1) trusty; urgency=low

  * New upstream release.
    - LP: #1217098 - Avoid re-downloading data files when possible.
    - LP: #1247215 - Change to D-Bus API; ApplyUpdate() is now
                     asynchronous and returns nothing, and there is a new
                     Rebooting signal.
    - LP: #1221843 - Removed support for the old channels.json format.
    - LP: #1220238 - Removed support for the old version numbers.
    - LP: #1238071 - Switch to the nose2 test runner.
    - LP: #1241236 - Write the ubuntu_command file atomically.
    - LP: #1243612 - Clarify that --channel should be used with --build 0
                     to switch channels.
    - LP: #1245597 - Empty download lists are ignored.
    - LP: #1195057 - Double check the validity of any cached image-master
                     or image-signing key.
    - LP: #1192717 - Double check the expiration date of any cached
                     image-master or image-signing key.
    - LP: #1250181 - The download fails if a server misconfiguration
                     offers up the same data file for two different images
                     in the winning upgrade path.
    - LP: #1248639 - Provide more useful traceback information in various
                     places and conditions.
    - LP: #1250553 - Tweak the scoring algorithm to highly discourage
                     candidate upgrade paths that don't leave you at the
                     maximum available build number.
    - Remove the unused -u and --upgrade switches.
    - If the current channel is an alias, --info will show the channel target.
    - If an update includes a channel switch, --dry-run will tell you.
    - When running system-image-cli -v (single verbosity), some dots are
      printed to stderr to let you know something is happening.
    - Removed the unused state_file setting from client.ini.
  * d/control: Update build dependency for switch to nose2.
  * d/tests/control: nose output goes to stderr, so allow this restriction.
    (LP: #1240516)

 -- Barry Warsaw <barry@ubuntu.com>  Wed, 16 Oct 2013 10:08:01 -0400

system-image (1.9.1-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1240105 - Further refinement of permission checking/fixing.
    - LP: #1240106 - Work around some failures in DEP 8 tests.
  * d/control: Point Vcs-Bzr and Vcs-Browser to the packaging branch.
  * d/system-image-common.dirs: Add /var/log/system-image.
  * d/rules, d/tests/unittests: Set $SYSTEMIMAGE_REACTOR_TIMEOUT to 1200
    seconds to avoid random timeout errors.
  * d/system-image-common.postinst, system-image-common.postrm: debhelper
    scripts for ensuring the proper permissions and for purging directories.

 -- Barry Warsaw <barry@ubuntu.com>  Tue, 15 Oct 2013 11:23:54 -0400

system-image (1.9-0ubuntu2) saucy; urgency=low

  * d/tests/control: Add DEP-8 test dependency on python3-psutil.

 -- Colin Watson <cjwatson@ubuntu.com>  Tue, 15 Oct 2013 13:18:04 +0100

system-image (1.9-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1235975 - Ensure that temporary directories and log files are
      created with secure permissions and unguessable paths.
    - LP: #1233521 - Download files directly to the cache or data partitions.
    - LP: #1238102 - Proactively remove files from the cache and data
      partitions before starting to download (except `log` and `last_log`
      files in the cache partition.  This also improves the ability to
      recover from partial downloads without rebooting.
    - LP: #1238290 - Keep the D-Bus process alive as long as we're making
      progress, as tracked by any call to a D-Bus method or signal.
    - LP: #1237360 - Enable pause and resume support.
    - LP: #1206588 - Re-enable some previously skipped tests.
    - The [system]thread variable is no longer used; removed.
  * d/control: Add build dependency on python3-psutils.

 -- Barry Warsaw <barry@ubuntu.com>  Sat, 12 Oct 2013 13:24:46 -0400

system-image (1.8-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1221844 - Channel alias tracking.
    - LP: #1231628 - Phased update support.
    - LP: #1229807 - Default auto_download is restored to '1' (wifi-only).
    - LP: #1204618 - Plumb the progress signals through the D-Bus API.
    - LP: #1215946 - Only send an `UpdateFailed` signal in response to a
      `CancelUpdate()` call when a download is actually in progress.
  * Add DEP-8 autopkgtests.  (LP: #1229710)

 -- Barry Warsaw <barry@ubuntu.com>  Wed, 02 Oct 2013 17:19:22 -0400

system-image (1.7-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - Fix test for 32 bit systems.  Again.
    - LP: #1233379 - Reset the D-Bus reactor timeout every time we see an
      active signal from the D-Bus service we're talking to.

 -- Barry Warsaw <barry@ubuntu.com>  Mon, 30 Sep 2013 16:57:34 -0400

system-image (1.6-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1196991 - Use the new ubuntu-download-manager to manage all
      requested downloads.
    - LP: #1215943 - Use /userdata/.last_update file as the "last upgrade
      date" if the file exists.
    - Default D-Bus service timeout is now 1 hour.
    - Default D-Bus logging level is now `info`.
    - Verbose (i.e. `debug`) logging now includes the scores and paths for all
      upgrade candidates, from highest score (biggest loser) to lowest score
      (winner) last.
    - --verbose logging level is now properly propagated to the log file.

 -- Barry Warsaw <barry@ubuntu.com>  Sun, 29 Sep 2013 15:17:17 -0400

system-image (1.5.1-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - Fix test for 32 bit systems.

 -- Barry Warsaw <barry@ubuntu.com>  Sun, 08 Sep 2013 10:23:12 -0400

system-image (1.5-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - `system-image-cli --info` prints additional information:
       + last update time (i.e. the mtime of `/etc/system-image/channel.ini`
         falling back to the mtime of `/etc/ubuntu-build`).
       + version details for ubuntu, the device, and any custom version, if the
         `/etc/system-image/channel.ini` file contains these details.
    - `system-image-cli --dry-run -c <bad-channel>` no longer produces a
       traceback.  You get "Already up-to-date", but use `-v` for more info.
    - D-Bus API method `UpdateAvailableStatus` field `last_update_date`
      has changes its format.  It's still ISO 8601, but with a space
      instead of a 'T' separating the date from the time.
    - LP: #1221841 - Support the new channels.json file format with
      backward compatibility (for now) with the old format.
    - LP: #1215959 - New D-Bus .Info() method returns data similar to
      `system-image-cli --info`

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 06 Sep 2013 18:34:29 -0400

system-image (1.4-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1218612 - Support the new version number regime, which uses
      sequential version numbers starting at 1.
    - Update the `system-image-cli` manpage.

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 30 Aug 2013 12:46:38 -0400

system-image (1.3-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1217932 - Fix bug in resolving channels with dashes in their name.
    - LP: #1208909 - Add system-image-cli --filter
    - Added -i/--info to get current build number, device, and channel.
    - Re-purposed -c/--channel to allow for overriding the channel name.
    - Re-purposed -b/--build to allow for overriding the build number.
    - Added -d/--device to allow for overriding the device name.
    - State persistence is disabled for now.  (LP: #1218357)
    - LP: #1192575 supported by `system-image-cli -c <channel> --filter=full`.

 -- Barry Warsaw <barry@ubuntu.com>  Thu, 29 Aug 2013 12:23:56 -0400

system-image (1.2-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1214009 - Support /etc/system-image/channel.ini
    - LP: #1212713 - Add system-image-cli --dry-run
    - Set auto_download mode to '0' (manual) to prevent inadvertent
      downloading over 3G while we wait for the download service.

 -- Barry Warsaw <barry@ubuntu.com>  Mon, 26 Aug 2013 18:46:43 -0400

system-image (1.1-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1212781 - New DBus API for u/i.
    - LP: #1207117 - Use nose as the test runner.
    - debian/control: Add python3-nose as a B-D.

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 23 Aug 2013 20:11:35 -0400

system-image (1.0-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1206617 - Add manpage for system-image-dbus.
    - LP: #1205163 - Run all dbus tests at build time.
    - LP: #1206515 - system-image-dbus creates temporary directory.
    - LP: #1206866 - Fix TypeError when two paths have the same score.
    - LP: #1207391 - Added some useful tools.
    - LP: #1206898 - Print the channel/device to the log file.
    - Added system-image-cli --dbus for upgrading from the command line
      over DBus.
    - Logging updates: see client.ini for log file location and level.

 -- Barry Warsaw <barry@ubuntu.com>  Thu, 01 Aug 2013 20:29:29 -0400

system-image (0.9.2-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1206558 - Run system-image-dbus on the system bus.
    - LP: #1206523 - Install policy file com.canonical.SystemImage.conf
      into /etc/dbus-1/system.d/
    - Use full path to executable in dbus service file.
    - Move system-image-dbus executable to /usr/sbin
    - client.ini: Bump dbus timeout to 10 minutes.

 -- Barry Warsaw <barry@ubuntu.com>  Tue, 30 Jul 2013 11:56:33 -0400

system-image (0.9.1-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - Further DBus API refinements to better support U/I development.
      + Add a .Exit() method.
      + Calling .Cancel() immediately issues a Canceled signal.
      + .GetUpdate() and .Reboot() no longer issue Canceled signals, but they
        no-op if a .Cancel() has been previously called.

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 26 Jul 2013 12:00:41 -0400

system-image (0.9-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1204976 (DBus API changes for u/i work)
    - LP: #1204528 (DBus mocks for u/i work)

 -- Barry Warsaw <barry@ubuntu.com>  Thu, 25 Jul 2013 23:20:38 -0400

system-image (0.8-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1204090 (calculate device type from system, not client.ini file)
    - Add -c/--channel option to system-image-cli; this prints the
      channel/device name being used.

 -- Barry Warsaw <barry@ubuntu.com>  Wed, 24 Jul 2013 14:19:04 -0400

system-image (0.7-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1202915 (don't reboot when there's no update available)
    - LP: #1192585 (DBus API)
    - LP: #1202283 (More useful -v diagnostics)
  * d/control:
    - New binary package: system-image-dbus
    - Additional build dependencies
    - Various Depends fixes
  * d/rules:
    - Add dh_install rules for system-image-dbus

 -- Barry Warsaw <barry@ubuntu.com>  Mon, 22 Jul 2013 19:13:59 -0400

system-image (0.6-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1200981 (fit image hash into 32 bits)

 -- Barry Warsaw <barry@ubuntu.com>  Mon, 15 Jul 2013 11:39:43 -0400

system-image (0.5-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1195479 (add manpages)

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 12 Jul 2013 18:31:21 -0400

system-image (0.4-0ubuntu2) saucy; urgency=low

  * Re-enable build-time tox tests. (LP: #1195420)

 -- Barry Warsaw <barry@ubuntu.com>  Fri, 12 Jul 2013 15:58:11 -0400

system-image (0.4-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1199981 (fix reboot command)
    - LP: #1199986 (fix ubuntu_command file ordering)
    - LP: #1199982 (ensure the keyring tar.xz target directory exists)
  * debian/system-image.common.dirs: /var/lib/system-image is included in
    system-image-common. (LP: #1199982)

 -- Barry Warsaw <barry@ubuntu.com>  Thu, 11 Jul 2013 10:47:34 -0400

system-image (0.3-0ubuntu1) saucy; urgency=low

  * New upstream release.
    - LP: #1199177 (default client.ini file updates)
    - LP: #1199361 (fix timeout errors)
    - LP: #1199498 (update ubuntu_command format)
    - LP: #1199488 (include archive master key)
  * debian/control: Strengthen the Depends between system-image-cli and
    system-image-common.

 -- Barry Warsaw <barry@ubuntu.com>  Tue, 09 Jul 2013 14:37:58 -0400

system-image (0.2-0ubuntu1) saucy; urgency=low

  * Initial release. (LP: #1193142)

 -- Barry Warsaw <barry@ubuntu.com>  Thu, 27 Jun 2013 10:20:23 -0400
